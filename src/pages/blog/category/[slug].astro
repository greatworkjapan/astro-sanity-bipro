---
import Layout from "../../../layouts/Layout.astro";
import { client } from "../../../lib/sanity";
import { categorySlugsQuery, postsByCategoryQuery } from "../../../lib/queries";

export async function getStaticPaths() {
  const cats = await client.fetch(categorySlugsQuery);
  return cats.map((c: any) => ({ params: { slug: c.slug } }));
}

const { slug } = Astro.params;
const posts = await client.fetch(postsByCategoryQuery, { slug });
---

<Layout>
  <section class="container mx-auto px-4 py-10">
    <!-- Breadcrumbs -->
    <nav class="mb-6 text-sm breadcrumbs text-gray-500" aria-label="breadcrumb">
      <ul class="flex flex-wrap gap-1">
        <li><a href="/" class="hover:underline">Home</a></li>
        <li>/</li>
        <li><a href="/blog" class="hover:underline">Blog</a></li>
        <li>/</li>
        <li class="text-gray-700 font-medium">カテゴリー: {slug}</li>
      </ul>
    </nav>

    <h1 class="text-3xl font-bold mb-6">カテゴリー: {slug}</h1>

    {posts.length === 0 ? (
      <p class="text-gray-500">まだ記事がありません。</p>
    ) : (
      <ul class="space-y-4">
        {posts.map((p: any) => (
          <li class="p-4 border rounded-lg hover:bg-base-200 transition">
            <a href={`/blog/${p.slug}`} class="text-primary font-semibold">
              {p.title}
            </a>
            <p class="text-sm text-gray-500">{p.excerpt}</p>
          </li>
        ))}
      </ul>
    )}
  </section>
</Layout>
